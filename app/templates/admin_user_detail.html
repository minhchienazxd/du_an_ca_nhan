<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>Chi ti·∫øt ng∆∞·ªùi d√πng</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
    }
    h1 {
      margin-bottom: 10px;
    }
    .info-box {
      border: 1px solid #ccc;
      padding: 15px;
      border-radius: 8px;
      background-color: #f9f9f9;
      margin-bottom: 20px;
    }
    .info-box p {
      margin: 6px 0;
    }
    .tabs {
      margin-bottom: 20px;
    }
    .tab-button {
      padding: 10px 20px;
      border: none;
      background-color: #eee;
      margin-right: 10px;
      cursor: pointer;
      border-radius: 5px;
    }
    .tab-button.active {
      background-color: #007bff;
      color: white;
    }
    .tab-content {
      display: none;
    }
    .tab-content.active {
      display: block;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 10px;
    }
    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      text-align: left;
    }
    .pending { color: orange; }
    .approved { color: green; }
    .rejected { color: red; }
    .back-btn {
      margin-top: 10px;
      display: inline-block;
      text-decoration: none;
      padding: 8px 16px;
      background-color: #007bff;
      color: white;
      border-radius: 4px;
    }
  </style>
</head>
<body>

  <h1>üë§ Th√¥ng tin ng∆∞·ªùi d√πng</h1>
  <div class="info-box">
    <p><strong>T√™n:</strong> {{ user.name }}</p>
    <p><strong>Email:</strong> {{ user.email or "Ch∆∞a c√≥" }}</p>
    <p><strong>SƒêT:</strong> {{ user.phone or "Ch∆∞a c√≥" }}</p>
    <p><strong>Ph∆∞∆°ng th·ª©c ƒëƒÉng nh·∫≠p:</strong> {{ user.method }}</p>
    <p><strong>S·ªë d∆∞:</strong> {{ "{:,.0f}".format((user.balance )) }} VNƒê</p>
    <a href="/admin/users" class="back-btn">‚Üê Quay v·ªÅ danh s√°ch ng∆∞·ªùi d√πng</a>
  </div>

  <div class="tabs">
    <button class="tab-button active" onclick="showTab('nap')">üí∞ N·∫°p ti·ªÅn</button>
    <button class="tab-button" onclick="showTab('rut')">üì§ R√∫t ti·ªÅn</button>
    <button class="tab-button" onclick="showTab('ghi')">üìú Ghi l√¥</button>
  </div>

  <div class="tab-content active" id="tab-nap">
    {% if nap_tiens %}
      <table>
        <thead>
          <tr>
            <th>Ng√¢n h√†ng</th><th>T√™n</th><th>S·ªë TK</th><th>S·ªë ti·ªÅn</th><th>N·ªôi dung</th><th>Th·ªùi gian</th><th>Tr·∫°ng th√°i</th><th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody>
          {% for nap in nap_tiens %}
          <tr>
            <td>{{ nap.bank }}</td>
            <td>{{ nap.name }}</td>
            <td>{{ nap.stk }}</td>
            <td>{{ nap.amount }}</td>
            <td>{{ nap.content }}</td>
            <td>{{ nap.time.strftime('%Y-%m-%d %H:%M') }}</td>
            <td class="{{ nap.status }}">{{ nap.status }}</td>
            <td>
              {% if nap.status == 'pending' and is_admin %}
              <form action="{{ url_for('admin.xac_nhan_nap', nap_id=nap._id) }}" method="post" style="display:inline;">
                <button type="submit">‚úÖ Duy·ªát</button>
              </form>
              <form action="{{ url_for('admin.tu_choi_nap', nap_id=nap._id) }}" method="post" style="display:inline;">
                <button type="submit">‚ùå T·ª´ ch·ªëi</button>
              </form>
              {% else %}<em>ƒê√£ x·ª≠ l√Ω</em>{% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>Kh√¥ng c√≥ l·ªãch s·ª≠ n·∫°p ti·ªÅn.</p>
    {% endif %}
  </div>

  <div class="tab-content" id="tab-rut">
    {% if rut_tiens %}
      <table>
        <thead>
          <tr><th>Ng√¢n h√†ng</th><th>S·ªë t√†i kho·∫£n</th><th>T√™n</th><th>S·ªë ti·ªÅn</th><th>Th·ªùi gian</th><th>Tr·∫°ng th√°i</th><th>H√†nh ƒë·ªông</th></tr>
        </thead>
        <tbody>
          {% for rut in rut_tiens %}
          <tr>
            <td>{{ rut.bank }}</td>
            <td>{{ rut.stk }}</td>
            <td>{{ rut.name }}</td>
            <td>{{ rut.amount }}</td>
            <td>{{ rut.time.strftime('%Y-%m-%d %H:%M') }}</td>
            <td>{{ rut.status }}</td>
            <td>
              {% if rut.status == 'pending' and is_admin %}
              <form method="POST" action="{{ url_for('admin.xac_nhan_rut', rut_id=rut._id) }}">
                <button type="submit">‚úÖ X√°c nh·∫≠n</button>
              </form>
              <form method="POST" action="{{ url_for('admin.tu_choi_rut', rut_id=rut._id) }}">
                <button type="submit">‚ùå T·ª´ ch·ªëi</button>
              </form>
              {% else %}ƒê√£ x·ª≠ l√Ω{% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>Kh√¥ng c√≥ l·ªãch s·ª≠ r√∫t ti·ªÅn.</p>
    {% endif %}
  </div>

  <div class="tab-content" id="tab-ghi">
    {% if ghi_los %}
      <table>
        <thead>
          <tr>
            <th>S·ªë</th><th>ƒêi·ªÉm</th><th>Lo·∫°i</th><th>Tr·ª´ ti·ªÅn</th><th>Th·ªùi gian</th><th>Tr·∫°ng th√°i</th><th>H√†nh ƒë·ªông</th>
          </tr>
        </thead>
        <tbody>
          {% for ghi in ghi_los %}
          <tr>
            
            <td>{{ ghi.number }}</td>
            <td>{{ "{:,}".format(ghi.diem) }}</td>
            <td>{{ ghi.loai }}</td>
            <td>{{ "{:,}".format(ghi.tru_tien) }} ƒë</td>
            <td>{{ ghi.time.strftime("%Y-%m-%d %H:%M") }}</td>
            <td>
              {% if ghi.status == "pending" %}
                <span style="color: orange;">‚è≥ Ch·ªù x·ª≠ l√Ω</span>
              {% else %}
                ‚úÖ {{ ghi.ket_qua|capitalize }} ({{ "{:,}".format(ghi.so_tien_thang) }} ƒë)
              {% endif %}
            </td>
            <td>
              {% if ghi.status == "pending" and is_admin %}
              <form method="POST" action="{{ url_for('admin.xu_ly_ghi_lo', ghi_lo_id=ghi._id) }}">
                <input type="hidden" name="ket_qua" value="win">
                <button type="submit">‚úÖ Win</button>
              </form>
              <form method="POST" action="{{ url_for('admin.xu_ly_ghi_lo', ghi_lo_id=ghi._id) }}">
                <input type="hidden" name="ket_qua" value="lose">
                <button type="submit">‚ùå Lose</button>
              </form>
              {% else %}
              ƒê√£ x·ª≠ l√Ω
              {% endif %}
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    {% else %}
      <p>Kh√¥ng c√≥ l·ªãch s·ª≠ ghi l√¥.</p>
    {% endif %}
  </div>

  <script>
    function showTab(name) {
      const buttons = document.querySelectorAll('.tab-button');
      const contents = document.querySelectorAll('.tab-content');
      buttons.forEach(btn => btn.classList.remove('active'));
      contents.forEach(tab => tab.classList.remove('active'));

      document.querySelector('#tab-' + name).classList.add('active');
      event.target.classList.add('active');
    }
  </script>

</body>
</html>
